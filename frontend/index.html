<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Door Security System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container-header">
            <div class="logo-section">
                <div class="icon">üîê</div>
                <div class="header-text">
                    <h1>Smart Door Security System</h1>
                    <p>Multi-Authentication IoT Platform</p>
                </div>
            </div>
            <div class="header-right">
                <div class="welcome-text">Welcome, <strong id="userName">User</strong></div>
                <button class="btn-logout" onclick="logout()">üö™ Logout</button>
            </div>
        </div>
    </header>

    <!-- MQTT Status Bar -->
    <div class="mqtt-status-bar">
        <div class="container-status">
            <div class="status-indicator" id="mqttStatus">
                <span class="status-dot disconnected"></span>
                <span class="status-text">Connecting to MQTT Broker...</span>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <main class="dashboard">
        <div class="container-main">
            
            <!-- Panel Kontrol -->
            <section class="panel-kontrol">
                <h2 class="section-title">üéÆ Panel Kontrol</h2>
                <div class="control-grid">
                    <div class="control-card green" onclick="sendControl('unlock')">
                        <div class="control-icon">üîì</div>
                        <div class="control-text">Unlock Door</div>
                    </div>
                    <div class="control-card red" onclick="sendControl('lock')">
                        <div class="control-icon">üîí</div>
                        <div class="control-text">Lock Door</div>
                    </div>
                    <div class="control-card blue" onclick="openEnrollModal()">
                        <div class="control-icon">üë§</div>
                        <div class="control-text">Enroll New User</div>
                    </div>
                    <div class="control-card purple" onclick="sendControl('delete_user')">
                        <div class="control-icon">üóëÔ∏è</div>
                        <div class="control-text">Delete User</div>
                    </div>
                    <div class="control-card orange" onclick="sendControl('system_reset')">
                        <div class="control-icon">üîÑ</div>
                        <div class="control-text">System Reset</div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="delete-controls">
                    <h3 class="section-subtitle">üóëÔ∏è Data Management</h3>
                    <div class="control-grid">
                        <div class="control-card delete-auth" onclick="deleteData('auth', 'esp32cam')">
                            <div class="control-icon">üì∑</div>
                            <div class="control-text">Delete ESP32-CAM Data</div>
                        </div>
                        <div class="control-card delete-auth" onclick="deleteData('auth', 'rfid')">
                            <div class="control-icon">üí≥</div>
                            <div class="control-text">Delete RFID Data</div>
                        </div>
                        <div class="control-card delete-auth" onclick="deleteData('auth', 'fingerprint')">
                            <div class="control-icon">üëÜ</div>
                            <div class="control-text">Delete Fingerprint Data</div>
                        </div>
                        <div class="control-card delete-all" onclick="deleteAllData()">
                            <div class="control-icon">‚ö†Ô∏è</div>
                            <div class="control-text">Delete All Data</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Device Selection -->
            <section class="device-section">
                <h2 class="section-title">üì± Select Device</h2>
                <div class="device-cards">
                    <div class="device-card active" data-device="esp32cam" onclick="deviceManager.switchDevice('esp32cam')">
                        <div class="device-badge" id="badge-esp32cam">0</div>
                        <div class="device-icon">üì∑</div>
                        <div class="device-name">ESP32-CAM</div>
                    </div>
                    <div class="device-card" data-device="rfid" onclick="deviceManager.switchDevice('rfid')">
                        <div class="device-badge" id="badge-rfid">0</div>
                        <div class="device-icon">üí≥</div>
                        <div class="device-name">RFID</div>
                    </div>
                    <div class="device-card" data-device="fingerprint" onclick="deviceManager.switchDevice('fingerprint')">
                        <div class="device-badge" id="badge-fingerprint">0</div>
                        <div class="device-icon">üëÜ</div>
                        <div class="device-name">Fingerprint</div>
                    </div>
                </div>
            </section>

            <!-- Last Recognized Face -->
            <section class="last-face-section">
                <h2 class="section-title">üë§ Last Recognized Face</h2>
                <div class="last-face-container">
                    <div class="face-image-wrapper">
                        <img id="lastFaceImage" src="" alt="Last Face" style="display: none;" />
                        <div id="noFacePlaceholder" class="no-face-placeholder">
                            <span class="placeholder-icon">ü§∑</span>
                            No face recognition data yet
                        </div>
                    </div>
                    <div class="face-info">
                        <div class="face-info-item">
                            <span class="info-label">User Name:</span>
                            <span class="info-value" id="lastFaceName">-</span>
                        </div>
                        <div class="face-info-item">
                            <span class="info-label">User ID:</span>
                            <span class="info-value" id="lastFaceId">-</span>
                        </div>
                        <div class="face-info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="lastFaceStatus">-</span>
                        </div>
                        <div class="face-info-item">
                            <span class="info-label">Time:</span>
                            <span class="info-value" id="lastFaceTime">-</span>
                            <button class="btn-show-history" onclick="showFaceHistoryModal()">üìú View History</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Live Streaming Section - BARU -->
            <section class="streaming-section">
                <h2 class="section-title">üìπ Live Camera Feed</h2>
                <div class="stream-container">
                    <img id="cameraStream" src="" alt="Camera Stream" 
                         onerror="this.style.display='none'; document.getElementById('streamPlaceholder').style.display='flex';" 
                         onload="this.style.display='block'; document.getElementById('streamPlaceholder').style.display='none';" />
                    <div id="streamPlaceholder" class="stream-placeholder">
                        <div class="placeholder-icon">üì∑</div>
                        <div>Camera Offline</div>
                    </div>
                    <div class="stream-status">
                        <span class="stream-indicator" id="streamIndicator"></span>
                        <span id="streamStatusText">Disconnected</span>
                    </div>
                </div>
            </section>

            <!-- Statistics Overview -->
            <section class="statistics-section">
                <h2 class="section-title">üìä Statistics Overview</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">TOTAL ACCESS</div>
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-unit">attempts</div>
                    </div>
                    <div class="stat-box success-box">
                        <div class="stat-label">SUCCESS</div>
                        <div class="stat-value" id="statSuccess">0</div>
                        <div class="stat-unit">granted</div>
                    </div>
                    <div class="stat-box failed-box">
                        <div class="stat-label">FAILED</div>
                        <div class="stat-value" id="statFailed">0</div>
                        <div class="stat-unit">denied</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">AVG DELAY</div>
                        <div class="stat-value" id="statAvgDelay">0</div>
                        <div class="stat-unit">ms</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">AVG THROUGHPUT</div>
                        <div class="stat-value" id="statAvgThroughput">0</div>
                        <div class="stat-unit">bps</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">AVG MESSAGE SIZE</div>
                        <div class="stat-value" id="statAvgMsgSize">0</div>
                        <div class="stat-unit">bytes</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">AVG JITTER</div>
                        <div class="stat-value" id="statAvgJitter">0</div>
                        <div class="stat-unit">ms</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">AVG PACKET LOSS</div>
                        <div class="stat-value" id="statAvgPacketLoss">0</div>
                        <div class="stat-unit">%</div>
                    </div>
                </div>
            </section>

            <!-- MQTT Parameters -->
            <section class="mqtt-params-section">
                <h2 class="section-title">üì° MQTT Parameters</h2>
                <div class="params-detail-grid">
                    <div class="param-detail-card">
                        <div class="param-label">Payload</div>
                        <div class="param-value" id="paramPayload">-</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Topic</div>
                        <div class="param-value" id="paramTopic">-</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Delay</div>
                        <div class="param-value" id="paramDelay">- ms</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Throughput</div>
                        <div class="param-value" id="paramThroughput">- bps</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Message Size</div>
                        <div class="param-value" id="paramMsgSize">- bytes</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">QoS</div>
                        <div class="param-value" id="paramQos">1</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Jitter</div>
                        <div class="param-value" id="paramJitter">- ms</div>
                    </div>
                    <div class="param-detail-card">
                        <div class="param-label">Packet Loss</div>
                        <div class="param-value" id="paramPacketLoss">- %</div>
                    </div>
                </div>
            </section>

            <!-- Real-time Charts -->
            <section class="chart-section">
                <h2 class="section-title">üìà Real-time Network Analysis</h2>
                <div class="chart-wrapper">
                    <h3>‚è±Ô∏è Delay (ms)</h3>
                    nvass id="delayChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>üöÄ Throughput (bps)</h3>
                    anvas id="throughputChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>üì¶ Message Size (Bytes)</h3>
                    nvas id="messaggeSizeChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>üìâ Jitter (ms)</h3>
                    nvas iid="jitterChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>üìä Packet Loss (%)</h3>
                    nvass id="packetLossChart"></canvas>
                </div>
            </section>

            <!-- Activity Log -->
            <section class="activity-section">
                <h2 class="section-title">üìã Activity Log</h2>
                <div class="activity-log-container" id="activityLog">
                    <div class="no-activity">No activity yet...</div>
                </div>
            </section>

        </div>
    </main>

    <!-- Modal Enroll User -->
    <div class="modal" id="enrollModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Enroll New User</h2>
                <span class="modal-close" onclick="closeEnrollModal()">&times;</span>
            </div>
            <form id="enrollForm" onsubmit="submitEnroll(event)">
                <div class="form-group">
                    <label for="enrollName">User Name</label>
                    <input type="text" id="enrollName" required />
                </div>
                <div class="form-group">
                    <label for="enrollId">User ID</label>
                    <input type="text" id="enrollId" required />
                </div>
                <div class="form-group">
                    <label for="enrollDevice">Device Type</label>
                    <select id="enrollDevice" required>
                        <option value="esp32cam">ESP32-CAM (Face)</option>
                        <option value="rfid">RFID Card</option>
                        <option value="fingerprint">Fingerprint</option>
                    </select>
                </div>
                <button type="submit" class="btn-submit">‚úÖ Enroll User</button>
            </form>
        </div>
    </div>

    <!-- Modal Face History -->
    <div class="modal" id="faceHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìú Face Recognition History</h2>
                <span class="modal-close" onclick="closeFaceHistoryModal()">&times;</span>
            </div>
            <div id="faceRecognitionHistory" class="face-history-log">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Scripts -->
    <script src="mqttws31.min.js"></script>
    <script src="chart.umd.js"></script>
    <script src="mqtt-client.js"></script>
    <script src="chart-manager.js"></script>
    <script src="device-manager.js"></script>
    <script src="main.js"></script>
</body>
</html>
