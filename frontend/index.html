<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartDoor Admin Center</title>
    
    <!-- CSS & Fonts -->
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>

    <!-- SIDEBAR MENU -->
    <nav class="sidebar">
        <div class="logo-details">
            <i class='bx bxs-shield-check icon'></i>
            <div class="logo_name">SmartDoor</div>
            <i class='bx bx-menu' id="btn" ></i>
        </div>

        <ul class="nav-list">
            <li>
                <a href="#" class="active" onclick="showPage('dashboard')">
                    <i class='bx bxs-dashboard'></i>
                    <span class="links_name">Dashboard</span>
                </a>
                <span class="tooltip">Dashboard</span>
            </li>
            <li>
                <a href="#" onclick="showPage('control')">
                    <i class='bx bxs-joystick'></i>
                    <span class="links_name">Control Panel</span>
                </a>
                <span class="tooltip">Control</span>
            </li>
            <li>
                <a href="#" onclick="showPage('data')">
                    <i class='bx bxs-data'></i>
                    <span class="links_name">Data Logs</span>
                </a>
                <span class="tooltip">Data</span>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="profile">
                <div class="profile-details">
                    <div class="name_job">
                        <div class="name" id="userName">Admin</div>
                        <div class="job">Operator</div>
                    </div>
                </div>
                <i class='bx bx-log-out' id="logoutBtn" title="Logout"></i>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <section class="home-section">
        
        <!-- TOP BAR Status -->
        <div class="top-bar">
            <div class="status-indicator" id="mqttStatus">
                <span class="dot disconnected"></span>
                <span class="text">System Offline</span>
            </div>
            <div class="device-selector">
                <span class="active-device"><i class='bx bxs-camera'></i> ESP32-CAM (Master)</span>
            </div>
        </div>

        <!-- HALAMAN 1: DASHBOARD -->
        <div id="page-dashboard" class="page-content active">
            <div class="dashboard-grid">
                
                <!-- KIRI: MONITORING -->
                <div class="col-left">
                    <!-- Kartu Wajah -->
                    <div class="card face-card">
                        <div class="card-header">
                            <h3>üë§ TARGET DETECTED</h3>
                            <span class="badge-live">LIVE</span>
                        </div>
                        <div class="face-display">
                            <div class="scan-line"></div>
                            <img id="lastFaceImage" src="" alt="No Target" style="display:none;">
                            <div id="noFacePlaceholder">
                                <span>WAITING DATA...</span>
                            </div>
                        </div>
                        <div class="face-details">
                            <div class="detail-row">
                                <small>IDENTITY</small>
                                <strong id="lastFaceName">-</strong>
                            </div>
                            <div class="detail-row">
                                <small>STATUS</small>
                                <strong id="lastFaceStatus" class="badge">-</strong>
                            </div>
                            <div class="detail-row">
                                <small>TIME</small>
                                <strong id="lastFaceTime" class="font-mono">-</strong>
                            </div>
                            <button id="btnOpenStream" class="btn-stream full-width">
                                <i class='bx bx-video'></i> LIVE STREAM
                            </button>
                        </div>
                    </div>

                    <!-- Status Node -->
                    <div class="card node-list">
                        <h3>üì° NODES</h3>
                        <div class="node-item active">
                            <i class='bx bxs-microchip'></i> <span>ESP32 AI</span> <small class="online">ON</small>
                        </div>
                        <div class="node-item">
                            <i class='bx bxs-id-card'></i> <span>RFID</span> <small class="online">ON</small>
                        </div>
                        <div class="node-item">
                            <i class='bx bxs-fingerprint'></i> <span>Biometric</span> <small class="online">ON</small>
                        </div>
                    </div>
                </div>

                <!-- KANAN: NETWORK METRICS (LENGKAP) -->
                <div class="col-right">
                    <!-- Angka Statistik -->
                    <div class="stats-row">
                        <div class="stat-box">
                            <small>Total Access</small>
                            <h3 id="statTotal">0</h3>
                        </div>
                        <div class="stat-box success">
                            <small>Granted</small>
                            <h3 id="statSuccess">0</h3>
                        </div>
                        <div class="stat-box danger">
                            <small>Denied</small>
                            <h3 id="statFailed">0</h3>
                        </div>
                    </div>

                    <!-- Grafik & Data Teknis -->
                    <div class="card network-card">
                        <div class="card-header">
                            <h3>üìä NETWORK INTELLIGENCE</h3>
                            <span class="ping">Ping: <span id="statDelayHeader">0</span> ms</span>
                        </div>

                        <!-- 1. Grafik Utama (Delay) -->
                        <div class="main-chart-wrapper">
                            <canvas id="delayChart"></canvas>
                        </div>

                        <!-- 2. Grid 4 Grafik Kecil -->
                        <div class="sub-charts-grid">
                            <div class="mini-chart">
                                <span>Throughput</span>
                                <strong id="statThroughput" class="blue">0 bps</strong>
                                <div class="chart-tiny"><canvas id="throughputChart"></canvas></div>
                            </div>
                            <div class="mini-chart">
                                <span>Msg Size</span>
                                <strong id="statMsgSize" class="green">0 B</strong>
                                <div class="chart-tiny"><canvas id="messageSizeChart"></canvas></div>
                            </div>
                            <div class="mini-chart">
                                <span>Jitter</span>
                                <strong id="statJitter" class="orange">0 ms</strong>
                                <div class="chart-tiny"><canvas id="jitterChart"></canvas></div>
                            </div>
                            <div class="mini-chart">
                                <span>Packet Loss</span>
                                <strong id="statPacketLoss" class="red">0 %</strong>
                                <div class="chart-tiny"><canvas id="packetLossChart"></canvas></div>
                            </div>
                        </div>

                        <!-- 3. Tabel Data Teknis MQTT -->
                        <div class="mqtt-table">
                            <div class="mqtt-row header">
                                <span>TOPIC</span><span>QoS</span><span>PAYLOAD</span>
                            </div>
                            <div class="mqtt-row">
                                <span id="paramTopic" class="accent">...</span>
                                <span id="paramQos">0</span>
                                <span id="paramPayload" class="font-mono text-xs">...</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- HALAMAN 2: CONTROL PANEL -->
        <div id="page-control" class="page-content">
            <h2>üéÆ Remote Control</h2>
            <div class="control-grid">
                <div class="ctrl-card green" id="btnBukaPintu">
                    <i class='bx bxs-lock-open'></i>
                    <span>BUKA PINTU</span>
                </div>
                <div class="ctrl-card red" id="btnKunciPintu">
                    <i class='bx bxs-lock'></i>
                    <span>KUNCI PINTU</span>
                </div>
                <div class="ctrl-card blue" id="btnTambahUser">
                    <i class='bx bxs-user-plus'></i>
                    <span>TAMBAH USER</span>
                </div>
            </div>
        </div>

        <!-- HALAMAN 3: DATA MANAGEMENT -->
        <div id="page-data" class="page-content">
            <h2>üíæ Data Management</h2>
            <div class="control-grid">
                <button id="btnClearAllLogs" class="ctrl-card danger">
                    <i class='bx bxs-trash'></i> <span>RESET ALL DATA</span>
                </button>
                <button id="btnDownloadReport" class="ctrl-card info">
                    <i class='bx bxs-download'></i> <span>DOWNLOAD REPORT</span>
                </button>
            </div>
        </div>

        <!-- HALAMAN 4: LOGS -->
        <div id="page-logs" class="page-content">
            <h2>üìã Activity Logs</h2>
            <div class="log-container" id="activityLog">
                <div class="log-empty">System Ready...</div>
            </div>
        </div>

    </section>

    <!-- MODAL STREAM -->
    <div id="streamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üé• SECURE FEED</h3>
                <span class="close" id="closeStreamModal">&times;</span>
            </div>
            <div class="stream-body">
                <img id="streamVideo" src="" alt="Offline">
                <div class="rec-badge">‚óè LIVE</div>
            </div>
        </div>
    </div>

    <!-- MODAL USER -->
    <div id="modalAddUser" class="modal">
        <div class="modal-content small">
            <span class="close" id="closeUserModal">&times;</span>
            <h3>Register User</h3>
            <form id="formAddUser">
                <input type="text" id="inputUsername" placeholder="Username" required>
                <input type="password" id="inputPassword" placeholder="Password" required>
                <button type="submit" class="btn-save">Save</button>
            </form>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="lib/chart.umd.js"></script>
    <script src="lib/mqttws31.min.js"></script>
    <script src="js/mqtt-client.js"></script>
    <script src="js/chart-manager.js"></script>
    <script src="js/device-manager.js"></script>
    <script src="js/main.js"></script>

    <script>
        let sidebar = document.querySelector(".sidebar");
        let closeBtn = document.querySelector("#btn");
        closeBtn.addEventListener("click", ()=>{ sidebar.classList.toggle("open"); });
        function showPage(id) {
            document.querySelectorAll('.page-content').forEach(e=>e.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
        }
    </script>
</body>
</html>