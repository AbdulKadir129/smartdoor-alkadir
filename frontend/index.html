<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Door Admin System</title>
    
    <link rel="stylesheet" href="css/style.css"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    
    <script src="js/mqtt-client.js"></script> 
    <script src="js/chart-manager.js"></script> 
    <script src="js/device-manager.js"></script>
</head>
<body>

    <nav class="sidebar">
        <div class="text-center mb-4 fw-bold fs-5"><i class="fas fa-shield-alt"></i> SECURITY ADMIN</div>
        <div class="nav-item active" onclick="switchPage('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</div>
        <div class="nav-item" onclick="switchPage('network')"><i class="fas fa-chart-line"></i> Network QoS</div>
        <div class="nav-item" onclick="switchPage('control')"><i class="fas fa-gamepad"></i> Control Center</div>
        <div class="nav-item" onclick="switchPage('data')"><i class="fas fa-database"></i> Data Logs</div>
    </nav>

    <main class="main-content">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-gray-800" id="page-title">Dashboard Overview</h3>
            <span id="mqtt-status" class="badge bg-secondary">Connecting...</span>
        </div>

        <div class="device-tabs">
            <button class="tab-btn active" onclick="switchDevice('cam')" id="btn-cam"><i class="fas fa-camera"></i> ESP32-CAM</button>
            <button class="tab-btn" onclick="switchDevice('rfid')" id="btn-rfid"><i class="fas fa-id-card"></i> RFID</button>
            <button class="tab-btn" onclick="switchDevice('finger')" id="btn-finger"><i class="fas fa-fingerprint"></i> FINGERPRINT</button>
        </div>

        <div id="page-dashboard" class="page-section active">
            <div class="row">
                <div class="col-lg-8">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between">
                            <span><i class="fas fa-eye"></i> Live Monitoring</span>
                            <span id="active-device-label" class="badge bg-primary">ESP32-CAM</span>
                        </div>
                        <div class="card-body">
                            <div id="view-cam" class="dev-view active">
                                <div class="cam-wrapper">
                                    <span class="badge bg-danger position-absolute top-0 end-0 m-3">LIVE</span>
                                    <img id="cam-feed" src="https://via.placeholder.com/640x360?text=Waiting+for+Face..." alt="Feed">
                                </div>
                            </div>
                            <div id="view-rfid" class="dev-view">
                                <div class="rfid-wrapper"><i class="fas fa-wifi fa-5x mb-3 text-primary"></i><h4>Waiting for Card...</h4></div>
                            </div>
                            <div id="view-finger" class="dev-view">
                                <div class="finger-wrapper"><i class="fas fa-fingerprint fa-5x mb-3 text-success"></i><h4>Place Finger...</h4></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card h-100">
                        <div class="card-header border-0 bg-white pb-0"><i class="fas fa-history me-2 text-primary"></i> Last Authenticated</div>
                        <div class="card-body">
                            <div class="text-center mb-4 mt-2">
                                <div style="width: 100px; height: 100px; background: #f1f3f9; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user fa-4x text-secondary" id="user-icon"></i>
                                </div>
                            </div>
                            <div class="px-2">
                                <div class="d-flex justify-content-between mb-3 border-bottom pb-2">
                                    <span class="text-muted">User Name:</span><span class="fw-bold text-dark" id="user-name">-</span>
                                </div>
                                <div class="d-flex justify-content-between mb-3 border-bottom pb-2">
                                    <span class="text-muted">User ID:</span><span class="fw-bold text-dark" id="user-id">-</span>
                                </div>
                                <div class="d-flex justify-content-between mb-3 border-bottom pb-2">
                                    <span class="text-muted">Status:</span><span class="fw-bold" id="auth-status">-</span>
                                </div>
                                <div class="d-flex justify-content-between mb-0">
                                    <span class="text-muted">Time:</span><span class="fw-bold text-dark" id="auth-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-network" class="page-section">
            <div class="row mb-4">
                <div class="col"><div class="card p-3 text-center border-start border-4 border-danger"><h4 id="val-delay">0 ms</h4><small>DELAY</small></div></div>
                <div class="col"><div class="card p-3 text-center border-start border-4 border-warning"><h4 id="val-jitter">0 ms</h4><small>JITTER</small></div></div>
                <div class="col"><div class="card p-3 text-center border-start border-4 border-primary"><h4 id="val-throughput">0 bps</h4><small>THROUGHPUT</small></div></div>
                <div class="col"><div class="card p-3 text-center border-start border-4 border-dark"><h4 id="val-loss">0 %</h4><small>LOSS</small></div></div>
                <div class="col"><div class="card p-3 text-center border-start border-4 border-success"><h4 id="val-size">0 B</h4><small>MSG SIZE</small></div></div>
            </div>
            
            <div class="row">
                <div class="col-lg-6 mb-4"><div class="card h-100 shadow-sm"><div class="card-body"><div class="chart-container"><canvas id="chartDelay"></canvas></div></div></div></div>
                <div class="col-lg-6 mb-4"><div class="card h-100 shadow-sm"><div class="card-body"><div class="chart-container"><canvas id="chartJitter"></canvas></div></div></div></div>
                <div class="col-lg-6 mb-4"><div class="card h-100 shadow-sm"><div class="card-body"><div class="chart-container"><canvas id="chartThroughput"></canvas></div></div></div></div>
                <div class="col-lg-6 mb-4"><div class="card h-100 shadow-sm"><div class="card-body"><div class="chart-container"><canvas id="chartLoss"></canvas></div></div></div></div>
                <div class="col-lg-6 mb-4 mx-auto"><div class="card h-100 shadow-sm"><div class="card-body"><div class="chart-container"><canvas id="chartSize"></canvas></div></div></div></div>
            </div>
        </div>

        <div id="page-control" class="page-section">
            <div class="row justify-content-center mt-4">
                <div class="col-md-4"><div class="btn-panel bg-open" onclick="kirimPerintah('open')"><i class="fas fa-door-open fa-3x mb-3"></i><br>BUKA PINTU</div></div>
                <div class="col-md-4"><div class="btn-panel bg-lock" onclick="kirimPerintah('lock')"><i class="fas fa-lock fa-3x mb-3"></i><br>KUNCI PINTU</div></div>
                <div class="col-md-4"><div class="btn-panel bg-enroll" onclick="kirimPerintah('enroll')"><i class="fas fa-user-plus fa-3x mb-3"></i><br>DAFTAR WAJAH</div></div>
            </div>
            <div class="card mt-4">
                <div class="card-header">System Status</div>
                <div class="card-body"><p>Status Pintu: <strong>Terkunci (Default)</strong></p><p>Koneksi MQTT: <strong class="text-success">Online</strong></p></div>
            </div>
        </div>

        <div id="page-data" class="page-section">
            <div class="card">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <span class="fw-bold"><i class="fas fa-list-alt me-2 text-primary"></i> Unified System Logs</span>
                    <button class="btn btn-sm btn-outline-danger" onclick="document.getElementById('log-table-body').innerHTML=''">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-hover table-striped align-middle mb-0">
                        <thead class="table-dark">
                            <tr><th>Time</th><th>Device</th><th>User ID</th><th>Data/Score</th><th>QoS Delay</th><th>Status</th></tr>
                        </thead>
                        <tbody id="log-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <script src="js/main.js"></script>
    
</body>
</html>